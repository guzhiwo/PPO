**Дата:** 5 ноября 2023 г.

**Статус:** Принято

**Контекст:**

При разработке сервиса такси мы стоим перед выбором архитектурной формы системы. Нам необходимо учесть масштабируемость,
надежность, скорость разработки и возможность быстро вносить изменения.

**Рассмотренные варианты:**

1. **Модульный монолит:** Одно приложение, разделенное на модули, каждый из которых отвечает за определенную
   функциональность.
2. **Микросервисы:** Разделение системы на независимые сервисы, которые взаимодействуют между собой посредством API.
3. **Серверлесс:** Архитектура, при которой разработчикам не требуется управлять серверами, а код выполняется в ответ на
   события.

**Решение:**

Выбраны микросервисы.

**Обоснование:**

- **Простота продуктовой разработки:** Проверяем множество гипотез, по статистике из которых не приживается более 80%.
- **Удобство тестирования:** Прогоны тестов в отдельной изолированной среде, независимый релиз микросервисов.
- **Практичность разработки:** Не можем сразу понять в каком направлении нужно развивать архитектуру.
- **Расширенные возможности многоплатформенности:** Облегчаем поддержку различных платформ и устройств, что может быть
  критически важно для сервиса такси с мобильными приложениями для разных операционных систем.
- **Повышенная отказоустойчивость:** Микросервисы позволяют изолировать и контролировать отказы внутри конкретных
  сервисов, что уменьшает риск поломок всей системы. есть критичные требования по устойчивости приложения к нагрузкам
  и/или поддержке интеграции с внешними сервисами (платежные системы, банки, сервисы навигации).
- **Скорость разработки:** Бизнес планирует выводить на рынок изменения сразу по всем направлениям, и не готов ждать
  последовательного внедрения ключевых изменений в каждой области.
- **Разнородные требования бизнеса:** Бизнес выдвигает требования к блокам системы с различной скоростью, важность
  быстрого вывода в релиз отдельных блоков также неоднородна, есть экономически обусловленная необходимость дальнейших
  частых изменений в отдельных блоках (следование тренду, маркетинговой стратегии).

**Недостатки решения:**

- **Проблемы межсерверного взаимодействия:** Необходимость внедрения паттерна вроде circuit breaker.
- **Сложный мониторинг:** Видим количество успешных/неуспешных ответов в рамках конкретного микросевриса. Количество
  микросервисов зачастую очень большое. И уследить за всеми ними физически очень трудно.
- **Разношерстность используемых технологий:** Нужно как-то конфигурировать все микросервисы между собой и поддерживать
  «зоопарк» технологий.
- **Сложность развертывания:** Нужны системы оркестрации и деплоймента.

**Последствия:**

- Следует регулярно рефакторить код, чтобы избежать его усложнения.
- Необходимо регулярно проводить улучшение диагностики состояния сервисов.
- Важно разбивать микросервисы на типы надежности.
- Требуется уделять внимание процессингу асинхронных событий.
- Изолировать взаимодействие с запросами от клиента через API Gateway.
- Настроенная devops архитектура на поддержку независимой разработки. Мы должны быть готовы выделить ресурсы на это.
- Необходимость организации тестовых окружений, подходящих для независимого тестирования микросервисов, а также для
  тестирования взаимодействия микросервисов, и готовы уйти от концепции чистого end-to-end тестирования к структуре,
  состоящей из модульных, интеграционных, компонентных и end-to-end тестов с разработкой заглушек и публикацией
  контрактов.
- Должны чётко представлять себе структуру данных в каждом домене, знать потребности бизнеса и смогать выделять
  слабосвязанные или полностью независимые домены.

**Присутствовавшие люди:**

- Павел Ермаков
- Ярослав Кузьмин
- Даниил Пырков
